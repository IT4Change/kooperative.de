---
import MainNav from './MainNav.astro';
import InfoNav from './InfoNav.astro';
import MobileNav from './MobileNav.vue';
---

<header class="sticky top-0 z-40 bg-white shadow-sm">
  <!-- Info Nav Bar -->
  <div class="bg-primary-900 text-primary-100 hidden md:block">
    <div class="container-page">
      <div class="flex justify-end items-center h-8 text-xs">
        <InfoNav />
      </div>
    </div>
  </div>

  <!-- Main Header -->
  <div class="container-page">
    <div class="flex items-center justify-between h-16 md:h-20">
      <!-- Logo / Site Name -->
      <a
        href="/"
        class="flex items-center gap-3 text-primary-800 hover:text-primary-600 transition-colors no-underline"
      >
        <svg
          class="w-8 h-8 md:w-10 md:h-10 text-primary-600"
          viewBox="0 0 40 40"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
          aria-hidden="true"
        >
          <circle cx="20" cy="20" r="18" stroke="currentColor" stroke-width="2" />
          <path
            d="M20 8c-2 4-6 6-6 12a6 6 0 0 0 12 0c0-6-4-8-6-12Z"
            fill="currentColor"
            opacity="0.3"
          />
          <path
            d="M20 8c-2 4-6 6-6 12a6 6 0 0 0 12 0c0-6-4-8-6-12Z"
            stroke="currentColor"
            stroke-width="1.5"
          />
          <path d="M16 28c1 2 3 3 4 3s3-1 4-3" stroke="currentColor" stroke-width="1.5" />
        </svg>
        <span class="font-serif font-bold text-lg md:text-xl leading-tight">
          Kooperative<br class="hidden sm:block" />
          <span class="text-primary-600">DÃ¼rnau</span>
        </span>
      </a>

      <!-- Desktop Navigation -->
      <div class="hidden md:flex items-center gap-6">
        <MainNav />
      </div>

      <!-- Right side: Cart + Mobile Menu -->
      <div class="flex items-center gap-2">
        <!-- Cart Icon (always visible) -->
        <a
          href="/bestellung/warenkorb"
          class="relative inline-flex items-center justify-center w-10 h-10 rounded-full text-gray-600 hover:text-primary-700 hover:bg-primary-50 transition-colors"
          aria-label="Warenkorb"
        >
          <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 0 0-3 3h15.75m-12.75-3h11.218c1.121-2.3 2.1-4.684 2.924-7.138a60.114 60.114 0 0 0-16.536-1.84M7.5 14.25 5.106 5.272M6 20.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Zm12.75 0a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Z"
            />
          </svg>
          <span
            id="cart-count-badge"
            class="absolute -top-0.5 -right-0.5 bg-primary-600 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center hidden"
          >
            0
          </span>
        </a>

        <!-- Mobile Menu (Vue island) -->
        <div class="md:hidden">
          <MobileNav client:load />
        </div>
      </div>
    </div>
  </div>
</header>

<script>
  import { $cartCount } from '../../lib/cart';

  function updateBadge() {
    const badge = document.getElementById('cart-count-badge');
    if (!badge) return;
    const count = $cartCount.get();
    badge.textContent = String(count);
    badge.classList.toggle('hidden', count === 0);
  }

  updateBadge();
  $cartCount.subscribe(updateBadge);
</script>
