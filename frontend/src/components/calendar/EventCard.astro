---
interface Props {
  title: string;
  date: string;
  endDate?: string;
  location?: string;
  description: string;
  image?: string;
  sectionName?: string;
  sectionSlug?: string;
}

const { title, date, endDate, location, description, image, sectionName, sectionSlug } = Astro.props;

function formatGermanDate(isoDate: string): string {
  const d = new Date(isoDate);
  return d.toLocaleDateString('de-DE', {
    day: 'numeric',
    month: 'long',
    year: 'numeric',
  });
}

function formatGermanTime(isoDate: string): string | null {
  const d = new Date(isoDate);
  const hours = d.getHours();
  const minutes = d.getMinutes();
  if (hours === 0 && minutes === 0) return null;
  return d.toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' });
}

const formattedDate = formatGermanDate(date);
const formattedEndDate = endDate ? formatGermanDate(endDate) : null;
const time = formatGermanTime(date);
const shortDescription = description.length > 150 ? description.slice(0, 150).trimEnd() + '...' : description;
---

<article class="group flex flex-col bg-white rounded-xl border border-gray-200 overflow-hidden hover:shadow-lg hover:border-primary-300 transition-all duration-200">
  {image ? (
    <div class="relative h-48 overflow-hidden bg-gray-100">
      <img
        src={image}
        alt={title}
        class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
        loading="lazy"
      />
      <div class="absolute top-3 left-3 bg-primary-700 text-white text-xs font-bold rounded-lg px-3 py-1.5 shadow-md">
        {formattedDate}
      </div>
    </div>
  ) : (
    <div class="relative h-32 bg-gradient-to-br from-primary-100 to-primary-200 flex items-center justify-center">
      <svg class="w-12 h-12 text-primary-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5" />
      </svg>
      <div class="absolute top-3 left-3 bg-primary-700 text-white text-xs font-bold rounded-lg px-3 py-1.5 shadow-md">
        {formattedDate}
      </div>
    </div>
  )}

  <div class="flex-1 flex flex-col p-4 md:p-5">
    {sectionName && (
      <div class="mb-2">
        {sectionSlug ? (
          <a
            href={`/${sectionSlug}`}
            class="inline-block text-xs font-semibold uppercase tracking-wider text-primary-600 hover:text-primary-800 transition-colors no-underline"
          >
            {sectionName}
          </a>
        ) : (
          <span class="text-xs font-semibold uppercase tracking-wider text-primary-600">
            {sectionName}
          </span>
        )}
      </div>
    )}

    <h3 class="text-lg font-serif font-bold text-gray-900 mb-2 leading-snug">
      {title}
    </h3>

    {formattedEndDate && formattedEndDate !== formattedDate && (
      <p class="text-sm text-gray-500 mb-1 flex items-center gap-1.5">
        <svg class="w-4 h-4 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5" />
        </svg>
        bis {formattedEndDate}
      </p>
    )}

    {time && (
      <p class="text-sm text-gray-500 mb-1 flex items-center gap-1.5">
        <svg class="w-4 h-4 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
        </svg>
        {time} Uhr
      </p>
    )}

    {location && (
      <p class="text-sm text-gray-500 mb-2 flex items-center gap-1.5">
        <svg class="w-4 h-4 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
          <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1 1 15 0Z" />
        </svg>
        {location}
      </p>
    )}

    <p class="text-sm text-gray-600 leading-relaxed mt-auto">
      {shortDescription}
    </p>
  </div>
</article>
